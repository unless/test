name: Update Workflow Automation

on:
  workflow_dispatch: # 手动触发
  schedule:
    - cron: '0 0 * * *' # 每天 UTC 午夜运行

jobs:
  changewf:
    name: Change a workflow file
    runs-on: ubuntu-22.04
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Check out repository
        uses: actions/checkout@v4.1.1
        with:
          token: ${{ secrets.WORKFLOW_TOKEN }} # 使用高权限 PAT

      - name: Make change to workflow file
        env:
          GITHUB_TOKEN: ${{ github.token }} # 用于创建 PR
        run: |
          # Create new branch
          git switch -c "feature-$(date +%s)"

          # Edit YOUR workflow file (确保路径和文件名正确！)
          echo "# Automated update on $(date)" >> .github/workflows/St1_Build-Rootfs-release.yml

          git config user.name "github-actions"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          git add .github/workflows/workflow.yml
          git commit -m "Automated workflow update"

          git push origin HEAD # 使用 WORKFLOW_TOKEN 推送

          # 使用 GITHUB_TOKEN 创建 PR
          gh pr create \
            --title "Automated Workflow Update" \
            --body "This PR updates the workflow file automatically." \
            --base main # 目标分支名 (根据你的仓库修改)
